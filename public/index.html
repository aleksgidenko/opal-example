<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Opal Example</title>
    <script src="js/opal.js" onload="Opal.load('opal')"></script>
    <script src="js/opal-parser.js" onload="Opal.load('opal-parser')"></script>
    <script src="js/browser.js"></script>
    <script src="js/http.js"></script>

    <script type="text/ruby">
      puts 'Running Ruby in Browser :-)'

      $iasip_top = []
      $cat_facts = []

      def add_to_container(text)
        DOM {
          div.info {
            span.red text
          }
        }.append_to($document['container'])
      end

      def add_cat_fact
        fact = $cat_facts.shift
        if fact != nil
          # add a cat fact to page every second till array empty
          add_to_container(fact['text'])
          puts fact['text']
        end
      end

      $document.ready do
        # reddit iasip
        #Browser::HTTP.get '/api/reddit/iasip' do
        #  on :success do |res|
        #    $iasip_top = res.json()['data']['children']
        #  end
        #end

        # cat facts
        Browser::HTTP.get '/api/cat/facts' do
          on :success do |res|
            $cat_facts = res.json()['all']
            $window.every(1, &add_cat_fact)
          end
        end
      end
    </script>

  </head>
  <body>
    <div id="container"></div>
  </body>
</html>